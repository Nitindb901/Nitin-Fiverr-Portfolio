<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men's Clothing Analytics - Interactive Dashboard with ML</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E86AB 0%, #2C3E50 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #2E86AB;
        }

        .header h1 {
            color: #2C3E50;
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .ml-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #2E86AB 0%, #2C3E50 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 10px 30px rgba(46, 134, 171, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transition: transform 0.5s;
        }

        .kpi-card:hover::before {
            transform: translate(-25%, -25%);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(46, 134, 171, 0.5);
        }

        .kpi-card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .kpi-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .kpi-card .change {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .kpi-card .icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2.5em;
            opacity: 0.3;
        }

        /* Filters */
        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border: 2px solid #e0e0e0;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }

        .filter-group button {
            padding: 10px 20px;
            border: 2px solid #2E86AB;
            border-radius: 8px;
            background: white;
            color: #2E86AB;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .filter-group button:hover {
            background: #2E86AB;
            color: white;
            transform: translateY(-2px);
        }

        .filter-group button.active {
            background: #2E86AB;
            color: white;
            box-shadow: 0 4px 15px rgba(46, 134, 171, 0.3);
        }

        /* ML Section */
        .ml-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .ml-section h2 {
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
        }

        .ml-insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .ml-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ml-card h4 {
            font-size: 1.1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .ml-card .ml-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .ml-card .ml-subtitle {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Chart Containers */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid #f0f0f0;
        }

        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #2E86AB;
        }

        .chart-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .chart-canvas {
            position: relative;
            height: 350px;
        }

        /* Insights Box */
        .insights-box {
            background: linear-gradient(135deg, #F18F01 0%, #C73E1D 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
            box-shadow: 0 10px 30px rgba(241, 143, 1, 0.3);
        }

        .insights-box h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .insight-icon {
            font-size: 1.5em;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .data-table thead {
            background: linear-gradient(135deg, #2E86AB 0%, #2C3E50 100%);
            color: white;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tbody tr {
            cursor: pointer;
            transition: background 0.3s;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.4s ease;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2em;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: #333;
            transform: rotate(90deg);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-icon {
            font-size: 4em;
            margin-bottom: 10px;
            animation: bounce 0.6s ease;
        }

        .modal-title {
            font-size: 2em;
            color: #2C3E50;
            margin-bottom: 5px;
        }

        .modal-subtitle {
            font-size: 1.1em;
            color: #666;
        }

        .modal-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .modal-stat-card {
            padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            text-align: center;
        }

        .modal-stat-card .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .modal-stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2C3E50;
        }

        .modal-insights {
            margin-top: 20px;
        }

        .modal-insight-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .modal-insight-icon {
            font-size: 1.5em;
            margin-top: 2px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .update-animation {
            animation: pulse 0.5s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 25px;
            }

            .modal-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>üéØ Men's Clothing Analytics Dashboard</h1>
            <p>Advanced Business Intelligence with Machine Learning</p>
            <span class="ml-badge">ü§ñ ML-Powered Insights</span>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card" onclick="showKPIDetail('revenue')">
                <span class="icon">üí∞</span>
                <h3>Total Revenue</h3>
                <div class="value" id="kpi-revenue">‚Çπ20.43 Cr</div>
                <div class="change">+22.3% vs Last Year</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('transactions')">
                <span class="icon">üõçÔ∏è</span>
                <h3>Total Transactions</h3>
                <div class="value" id="kpi-transactions">100K</div>
                <div class="change">Avg: ‚Çπ2,043 per order</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('customers')">
                <span class="icon">üë•</span>
                <h3>Unique Customers</h3>
                <div class="value" id="kpi-customers">11,998</div>
                <div class="change">8.3 orders per customer</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('margin')">
                <span class="icon">üìä</span>
                <h3>Profit Margin</h3>
                <div class="value" id="kpi-margin">26.63%</div>
                <div class="change">‚Çπ5.44 Cr total profit</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('clv')">
                <span class="icon">üíé</span>
                <h3>Avg Customer CLV</h3>
                <div class="value" id="kpi-clv">‚Çπ17,031</div>
                <div class="change">556 days avg tenure</div>
            </div>
        </div>

        <!-- ML Forecast Section -->
        <div class="ml-section">
            <h2>üîÆ Machine Learning Predictions</h2>
            <div class="ml-insights">
                <div class="ml-card">
                    <h4>Next Month Forecast</h4>
                    <div class="ml-value">‚Çπ6.67 Cr</div>
                    <div class="ml-subtitle">January 2025 Prediction</div>
                </div>
                <div class="ml-card">
                    <h4>6-Month Revenue</h4>
                    <div class="ml-value">‚Çπ5.22 Cr</div>
                    <div class="ml-subtitle">93.18% Model Accuracy</div>
                </div>
                <div class="ml-card">
                    <h4>VIP Customers</h4>
                    <div class="ml-value">3,367</div>
                    <div class="ml-subtitle">43.4% Revenue Share</div>
                </div>
                <div class="ml-card">
                    <h4>Growth Projection</h4>
                    <div class="ml-value">+2.1%</div>
                    <div class="ml-subtitle">vs Historical Average</div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <div class="filter-group">
                <label>Category Filter</label>
                <div style="display: flex; gap: 10px;">
                    <button class="filter-btn active" data-filter="category" data-value="all">All</button>
                    <button class="filter-btn" data-filter="category" data-value="Formal Wear">Formal</button>
                    <button class="filter-btn" data-filter="category" data-value="Casual Wear">Casual</button>
                    <button class="filter-btn" data-filter="category" data-value="Sports & Activewear">Sports</button>
                    <button class="filter-btn" data-filter="category" data-value="Accessories">Accessories</button>
                </div>
            </div>
        </div>

        <!-- Key Insights -->
        <div class="insights-box">
            <h3>üéØ Key Business Insights</h3>
            <div class="insight-item">
                <span class="insight-icon">üìä</span>
                <span>Casual Wear leads with ‚Çπ6.33 Cr (31% of revenue)</span>
            </div>
            <div class="insight-item">
                <span class="insight-icon">üèÜ</span>
                <span>Calvin Klein is top brand with ‚Çπ2.88 Cr revenue</span>
            </div>
            <div class="insight-item">
                <span class="insight-icon">üè™</span>
                <span>Delhi Connaught Place generates ‚Çπ2.09 Cr (top store)</span>
            </div>
            <div class="insight-item">
                <span class="insight-icon">üë•</span>
                <span>Champions segment has 1.7x higher CLV (‚Çπ29,239)</span>
            </div>
            <div class="insight-item">
                <span class="insight-icon">üìÖ</span>
                <span>Weekend sales contribute 28.5% of total revenue</span>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Category Performance -->
            <div class="chart-container">
                <h3 class="chart-title">üìä Category Revenue Performance</h3>
                <div class="chart-canvas">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>

            <!-- Monthly Trend -->
            <div class="chart-container">
                <h3 class="chart-title">üìà Monthly Revenue Trend</h3>
                <div class="chart-canvas">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- Channel Distribution -->
            <div class="chart-container">
                <h3 class="chart-title">üåê Sales Channel Distribution</h3>
                <div class="chart-canvas">
                    <canvas id="channelChart"></canvas>
                </div>
            </div>

            <!-- Customer Segments -->
            <div class="chart-container">
                <h3 class="chart-title">üë• Customer Segmentation (RFM)</h3>
                <div class="chart-canvas">
                    <canvas id="segmentChart"></canvas>
                </div>
            </div>

            <!-- Top Stores -->
            <div class="chart-container">
                <h3 class="chart-title">üè™ Top 10 Stores by Revenue</h3>
                <div class="chart-canvas">
                    <canvas id="storeChart"></canvas>
                </div>
            </div>

            <!-- ML Clusters -->
            <div class="chart-container">
                <h3 class="chart-title">ü§ñ ML Customer Clusters</h3>
                <div class="chart-canvas">
                    <canvas id="clusterChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Category Performance Table -->
        <div class="chart-container">
            <h3 class="chart-title">üìã Detailed Category Performance</h3>
            <table class="data-table" id="categoryTable">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Revenue</th>
                        <th>Share</th>
                        <th>Transactions</th>
                        <th>Avg Order Value</th>
                        <th>Margin %</th>
                    </tr>
                </thead>
                <tbody id="categoryTableBody">
                    <!-- Dynamic content -->
                </tbody>
            </table>
        </div>

        <!-- ML Forecast Chart -->
        <div class="chart-container" style="grid-column: 1 / -1;">
            <h3 class="chart-title">üîÆ 6-Month Revenue Forecast (ML Model)</h3>
            <div class="chart-canvas">
                <canvas id="forecastChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal(event)">√ó</span>
            <div class="modal-header">
                <div class="modal-icon" id="modalIcon"></div>
                <h2 class="modal-title" id="modalTitle"></h2>
                <p class="modal-subtitle" id="modalSubtitle"></p>
            </div>
            <div class="modal-stats" id="modalStats"></div>
            <div class="modal-insights" id="modalInsights"></div>
        </div>
    </div>

    <script>
        // Dashboard Data
        const dashboardData = {
            categories: [
                { name: 'Casual Wear', revenue: 63324348, share: 31.0, transactions: 39980, units: 51214, margin: 26.8, online: 21100000, offline: 42224348 },
                { name: 'Formal Wear', revenue: 51734404, share: 25.3, transactions: 24936, units: 29683, margin: 27.1, online: 17200000, offline: 34534404 },
                { name: 'Sports & Activewear', revenue: 56242190, share: 27.5, transactions: 20004, units: 24516, margin: 26.2, online: 18700000, offline: 37542190 },
                { name: 'Accessories', revenue: 33036094, share: 16.2, transactions: 15080, units: 18899, margin: 26.5, online: 11000000, offline: 22036094 }
            ],
            channels: [
                { name: 'In-Store', revenue: 68222935, share: 33.4 },
                { name: 'Online', revenue: 68045078, share: 33.3 },
                { name: 'Mobile App', revenue: 68069024, share: 33.3 }
            ],
            monthlyData: [
                { month: 'Jan 2023', revenue: 6985234, year: 2023 },
                { month: 'Feb 2023', revenue: 7123456, year: 2023 },
                { month: 'Mar 2023', revenue: 7890123, year: 2023 },
                { month: 'Apr 2023', revenue: 8234567, year: 2023 },
                { month: 'May 2023', revenue: 8456789, year: 2023 },
                { month: 'Jun 2023', revenue: 8123456, year: 2023 },
                { month: 'Jul 2023', revenue: 9234567, year: 2023 },
                { month: 'Aug 2023', revenue: 8567890, year: 2023 },
                { month: 'Sep 2023', revenue: 8345678, year: 2023 },
                { month: 'Oct 2023', revenue: 9123456, year: 2023 },
                { month: 'Nov 2023', revenue: 9456789, year: 2023 },
                { month: 'Dec 2023', revenue: 9876543, year: 2023 },
                { month: 'Jan 2024', revenue: 7234567, year: 2024 },
                { month: 'Feb 2024', revenue: 7456789, year: 2024 },
                { month: 'Mar 2024', revenue: 8123456, year: 2024 },
                { month: 'Apr 2024', revenue: 8567890, year: 2024 },
                { month: 'May 2024', revenue: 8789012, year: 2024 },
                { month: 'Jun 2024', revenue: 8456789, year: 2024 },
                { month: 'Jul 2024', revenue: 9567890, year: 2024 },
                { month: 'Aug 2024', revenue: 8890123, year: 2024 },
                { month: 'Sep 2024', revenue: 8678901, year: 2024 },
                { month: 'Oct 2024', revenue: 9345678, year: 2024 },
                { month: 'Nov 2024', revenue: 9678901, year: 2024 },
                { month: 'Dec 2024', revenue: 8543210, year: 2024 }
            ],
            segments: [
                { name: 'Potential Loyalists', count: 3666, clv: 15234 },
                { name: 'Loyal Customers', count: 3622, clv: 18567 },
                { name: 'Champions', count: 1859, clv: 29239 },
                { name: 'At Risk', count: 1139, clv: 12456 },
                { name: 'Lost Customers', count: 1131, clv: 8934 },
                { name: 'Recent Customers', count: 581, clv: 11234 }
            ],
            stores: [
                { name: 'Delhi Connaught Place', revenue: 20900862 },
                { name: 'Mumbai MG Road', revenue: 20688432 },
                { name: 'Bangalore Indiranagar', revenue: 20567891 },
                { name: 'Pune FC Road', revenue: 20456789 },
                { name: 'Hyderabad Banjara Hills', revenue: 20345678 },
                { name: 'Chennai T Nagar', revenue: 20234567 },
                { name: 'Kolkata Park Street', revenue: 20123456 },
                { name: 'Ahmedabad CG Road', revenue: 20012345 },
                { name: 'Jaipur MI Road', revenue: 19901234 },
                { name: 'Chandigarh Sector 17', revenue: 20105782 }
            ],
            mlClusters: [
                { name: 'VIP Customers', count: 3367, revenue: 43.4, avgSpend: 26344 },
                { name: 'Regular Shoppers', count: 7011, revenue: 39.1, avgSpend: 11426 },
                { name: 'Loyal Actives', count: 1620, revenue: 17.5, avgSpend: 22091 }
            ],
            forecast: [
                { month: 'Jan 2025', predicted: 6665516, lower: 5665689, upper: 7665343 },
                { month: 'Feb 2025', predicted: 8430767, lower: 7166152, upper: 9695382 },
                { month: 'Mar 2025', predicted: 9231924, lower: 7847135, upper: 10616713 },
                { month: 'Apr 2025', predicted: 9261988, lower: 7872689, upper: 10651287 },
                { month: 'May 2025', predicted: 9392740, lower: 7983829, upper: 10801651 },
                { month: 'Jun 2025', predicted: 9188788, lower: 7810470, upper: 10567106 }
            ]
        };

        let currentFilter = 'all';

        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            createCategoryChart();
            createTrendChart();
            createChannelChart();
            createSegmentChart();
            createStoreChart();
            createClusterChart();
            createForecastChart();
            populateCategoryTable();
            setupFilters();
        });

        // Setup Filters
        function setupFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons in the same group
                    const filter = this.dataset.filter;
                    document.querySelectorAll(`[data-filter="${filter}"]`).forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentFilter = this.dataset.value;
                    updateDashboard();
                });
            });
        }

        // Update Dashboard based on filter
        function updateDashboard() {
            const container = document.querySelector('.dashboard-container');
            container.classList.add('update-animation');
            
            setTimeout(() => {
                updateCategoryChart();
                populateCategoryTable();
                container.classList.remove('update-animation');
            }, 300);
        }

        // Create Category Chart
        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            const data = currentFilter === 'all' ? 
                dashboardData.categories : 
                dashboardData.categories.filter(c => c.name === currentFilter);

            window.categoryChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(c => c.name),
                    datasets: [{
                        label: 'Revenue (‚Çπ)',
                        data: data.map(c => c.revenue),
                        backgroundColor: ['#2E86AB', '#3498DB', '#E74C3C', '#9B59B6'],
                        borderColor: ['#1a5270', '#2874a6', '#c0392b', '#7d3c98'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '‚Çπ' + (context.raw / 10000000).toFixed(2) + ' Cr';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + (value / 10000000).toFixed(1) + 'Cr';
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            showCategoryDetail(data[index]);
                        }
                    }
                }
            });
        }

        // Update Category Chart
        function updateCategoryChart() {
            if (window.categoryChartInstance) {
                window.categoryChartInstance.destroy();
            }
            createCategoryChart();
        }

        // Create Trend Chart
        function createTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dashboardData.monthlyData.map(m => m.month),
                    datasets: [{
                        label: 'Monthly Revenue',
                        data: dashboardData.monthlyData.map(m => m.revenue),
                        borderColor: '#2E86AB',
                        backgroundColor: 'rgba(46, 134, 171, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '‚Çπ' + (context.raw / 10000000).toFixed(2) + ' Cr';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + (value / 10000000).toFixed(1) + 'Cr';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create Channel Chart
        function createChannelChart() {
            const ctx = document.getElementById('channelChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dashboardData.channels.map(c => c.name),
                    datasets: [{
                        data: dashboardData.channels.map(c => c.revenue),
                        backgroundColor: ['#2E86AB', '#A23B72', '#F18F01'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 12 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = '‚Çπ' + (context.raw / 10000000).toFixed(2) + ' Cr';
                                    const percent = context.parsed + '%';
                                    return label + ': ' + value + ' (' + dashboardData.channels[context.dataIndex].share + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create Segment Chart
        function createSegmentChart() {
            const ctx = document.getElementById('segmentChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: dashboardData.segments.map(s => s.name),
                    datasets: [{
                        data: dashboardData.segments.map(s => s.count),
                        backgroundColor: ['#2E86AB', '#3498DB', '#06A77D', '#F18F01', '#C73E1D', '#9B59B6'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { font: { size: 11 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const count = context.raw.toLocaleString();
                                    const percent = ((context.raw / 11998) * 100).toFixed(1);
                                    return label + ': ' + count + ' (' + percent + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create Store Chart
        function createStoreChart() {
            const ctx = document.getElementById('storeChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dashboardData.stores.map(s => s.name.split(' ')[0]),
                    datasets: [{
                        label: 'Revenue (‚Çπ)',
                        data: dashboardData.stores.map(s => s.revenue),
                        backgroundColor: '#06A77D',
                        borderColor: '#048860',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '‚Çπ' + (context.raw / 10000000).toFixed(2) + ' Cr';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + (value / 10000000).toFixed(1) + 'Cr';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create Cluster Chart
        function createClusterChart() {
            const ctx = document.getElementById('clusterChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dashboardData.mlClusters.map(c => c.name),
                    datasets: [{
                        label: 'Customer Count',
                        data: dashboardData.mlClusters.map(c => c.count),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb'],
                        borderWidth: 2,
                        borderColor: '#fff',
                        yAxisID: 'y'
                    }, {
                        label: 'Avg Spend (‚Çπ)',
                        data: dashboardData.mlClusters.map(c => c.avgSpend),
                        type: 'line',
                        borderColor: '#F18F01',
                        backgroundColor: 'rgba(241, 143, 1, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y1',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Customers' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Avg Spend (‚Çπ)' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // Create Forecast Chart
        function createForecastChart() {
            const ctx = document.getElementById('forecastChart').getContext('2d');
            
            // Combine historical (last 6 months) with forecast
            const historicalData = dashboardData.monthlyData.slice(-6);
            const allLabels = [...historicalData.map(m => m.month), ...dashboardData.forecast.map(f => f.month)];
            const historicalValues = [...historicalData.map(m => m.revenue), ...new Array(6).fill(null)];
            const forecastValues = [...new Array(6).fill(null), ...dashboardData.forecast.map(f => f.predicted)];
            const lowerBound = [...new Array(6).fill(null), ...dashboardData.forecast.map(f => f.lower)];
            const upperBound = [...new Array(6).fill(null), ...dashboardData.forecast.map(f => f.upper)];

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: allLabels,
                    datasets: [{
                        label: 'Historical Revenue',
                        data: historicalValues,
                        borderColor: '#2E86AB',
                        backgroundColor: 'rgba(46, 134, 171, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Forecasted Revenue',
                        data: forecastValues,
                        borderColor: '#A23B72',
                        backgroundColor: 'rgba(162, 59, 114, 0.1)',
                        borderWidth: 3,
                        borderDash: [10, 5],
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Confidence Interval',
                        data: upperBound,
                        borderColor: 'rgba(162, 59, 114, 0.3)',
                        backgroundColor: 'rgba(162, 59, 114, 0.1)',
                        borderWidth: 1,
                        fill: '+1',
                        pointRadius: 0,
                        tension: 0.4
                    }, {
                        label: '',
                        data: lowerBound,
                        borderColor: 'rgba(162, 59, 114, 0.3)',
                        backgroundColor: 'rgba(162, 59, 114, 0.1)',
                        borderWidth: 1,
                        fill: false,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                filter: function(item) {
                                    return item.text !== '';
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.raw === null) return '';
                                    return context.dataset.label + ': ‚Çπ' + (context.raw / 10000000).toFixed(2) + ' Cr';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + (value / 10000000).toFixed(1) + 'Cr';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Populate Category Table
        function populateCategoryTable() {
            const tbody = document.getElementById('categoryTableBody');
            const data = currentFilter === 'all' ? 
                dashboardData.categories : 
                dashboardData.categories.filter(c => c.name === currentFilter);
            
            tbody.innerHTML = data.map(cat => `
                <tr onclick='showCategoryDetail(${JSON.stringify(cat)})'>
                    <td><strong>${cat.name}</strong></td>
                    <td>‚Çπ${(cat.revenue / 10000000).toFixed(2)} Cr</td>
                    <td>${cat.share}%</td>
                    <td>${cat.transactions.toLocaleString()}</td>
                    <td>‚Çπ${(cat.revenue / cat.transactions).toFixed(0)}</td>
                    <td>${cat.margin}%</td>
                </tr>
            `).join('');
        }

        // Show KPI Detail Modal
        function showKPIDetail(kpi) {
            const modal = document.getElementById('modalOverlay');
            const icon = document.getElementById('modalIcon');
            const title = document.getElementById('modalTitle');
            const subtitle = document.getElementById('modalSubtitle');
            const stats = document.getElementById('modalStats');
            const insights = document.getElementById('modalInsights');

            const kpiData = {
                revenue: {
                    icon: 'üí∞',
                    title: 'Total Revenue',
                    subtitle: '‚Çπ20.43 Crores',
                    stats: [
                        { label: 'Casual Wear', value: '‚Çπ6.33 Cr' },
                        { label: 'Sports & Active', value: '‚Çπ5.62 Cr' },
                        { label: 'Formal Wear', value: '‚Çπ5.17 Cr' },
                        { label: 'Accessories', value: '‚Çπ3.30 Cr' }
                    ],
                    insights: [
                        { icon: 'üìà', text: '+22.3% growth from first to last month' },
                        { icon: 'üèÜ', text: 'Casual Wear leads with 31% market share' },
                        { icon: 'üíé', text: 'Premium brands contribute 28% of revenue' },
                        { icon: 'üåê', text: 'Online channels growing at 15% YoY' }
                    ]
                },
                transactions: {
                    icon: 'üõçÔ∏è',
                    title: 'Total Transactions',
                    subtitle: '100,000 Orders',
                    stats: [
                        { label: 'Avg Order Value', value: '‚Çπ2,043' },
                        { label: 'In-Store', value: '33,461' },
                        { label: 'Online', value: '33,305' },
                        { label: 'Mobile App', value: '33,234' }
                    ],
                    insights: [
                        { icon: 'üìä', text: 'Balanced channel distribution across all platforms' },
                        { icon: 'üí≥', text: '55% prefer digital payments (UPI, Cards)' },
                        { icon: 'üìÖ', text: 'Weekend transactions are 28.5% of total' },
                        { icon: 'üéØ', text: '39,980 transactions in Casual Wear alone' }
                    ]
                },
                customers: {
                    icon: 'üë•',
                    title: 'Unique Customers',
                    subtitle: '11,998 Active Customers',
                    stats: [
                        { label: 'Avg Purchases', value: '8.3 orders' },
                        { label: 'Champions', value: '1,859' },
                        { label: 'Loyal', value: '3,622' },
                        { label: 'At Risk', value: '1,139' }
                    ],
                    insights: [
                        { icon: 'üåü', text: '30.6% are Potential Loyalists (3,666 customers)' },
                        { icon: 'üí∞', text: 'Champions have 1.7x higher CLV than average' },
                        { icon: 'üîÑ', text: 'Repeat purchase rate is strong at 60%' },
                        { icon: 'üìà', text: 'Customer retention improved by 12% this year' }
                    ]
                },
                margin: {
                    icon: 'üìä',
                    title: 'Profit Margin',
                    subtitle: '26.63% Average Margin',
                    stats: [
                        { label: 'Total Profit', value: '‚Çπ5.44 Cr' },
                        { label: 'Formal Wear', value: '27.1%' },
                        { label: 'Casual Wear', value: '26.8%' },
                        { label: 'Accessories', value: '26.5%' }
                    ],
                    insights: [
                        { icon: 'üíé', text: 'Premium brands yield 5% higher margins' },
                        { icon: 'üéØ', text: 'Formal Wear has highest margin (27.1%)' },
                        { icon: 'üìâ', text: 'Deep discounts (30%+) reduce margin by 40%' },
                        { icon: 'üè™', text: 'In-store margins 2% higher than online' }
                    ]
                },
                clv: {
                    icon: 'üíé',
                    title: 'Customer Lifetime Value',
                    subtitle: '‚Çπ17,031 Average CLV',
                    stats: [
                        { label: 'Champions', value: '‚Çπ29,239' },
                        { label: 'Loyal', value: '‚Çπ18,567' },
                        { label: 'Potential', value: '‚Çπ15,234' },
                        { label: 'At Risk', value: '‚Çπ12,456' }
                    ],
                    insights: [
                        { icon: 'üëë', text: 'Champions segment generates 43.4% of revenue' },
                        { icon: '‚è±Ô∏è', text: 'Average customer tenure is 556 days' },
                        { icon: 'üîù', text: 'Top 20% customers contribute 60% of revenue' },
                        { icon: 'üéÅ', text: 'Loyalty programs increase CLV by 25%' }
                    ]
                }
            };

            const data = kpiData[kpi];
            icon.textContent = data.icon;
            title.textContent = data.title;
            subtitle.textContent = data.subtitle;

            stats.innerHTML = data.stats.map(stat => `
                <div class="modal-stat-card">
                    <div class="label">${stat.label}</div>
                    <div class="value">${stat.value}</div>
                </div>
            `).join('');

            insights.innerHTML = data.insights.map(insight => `
                <div class="modal-insight-item">
                    <span class="modal-insight-icon">${insight.icon}</span>
                    <span>${insight.text}</span>
                </div>
            `).join('');

            modal.style.display = 'flex';
        }

        // Show Category Detail Modal
        function showCategoryDetail(category) {
            const modal = document.getElementById('modalOverlay');
            const icon = document.getElementById('modalIcon');
            const title = document.getElementById('modalTitle');
            const subtitle = document.getElementById('modalSubtitle');
            const stats = document.getElementById('modalStats');
            const insights = document.getElementById('modalInsights');

            icon.textContent = 'üè∑Ô∏è';
            title.textContent = category.name;
            subtitle.textContent = '‚Çπ' + (category.revenue / 10000000).toFixed(2) + ' Crores Revenue';

            stats.innerHTML = `
                <div class="modal-stat-card">
                    <div class="label">Total Revenue</div>
                    <div class="value">‚Çπ${(category.revenue / 10000000).toFixed(2)} Cr</div>
                </div>
                <div class="modal-stat-card">
                    <div class="label">Market Share</div>
                    <div class="value">${category.share}%</div>
                </div>
                <div class="modal-stat-card">
                    <div class="label">Transactions</div>
                    <div class="value">${category.transactions.toLocaleString()}</div>
                </div>
                <div class="modal-stat-card">
                    <div class="label">Profit Margin</div>
                    <div class="value">${category.margin}%</div>
                </div>
            `;

            insights.innerHTML = `
                <div class="modal-insight-item">
                    <span class="modal-insight-icon">üåê</span>
                    <span>Online: ‚Çπ${(category.online / 10000000).toFixed(2)} Cr | Offline: ‚Çπ${(category.offline / 10000000).toFixed(2)} Cr</span>
                </div>
                <div class="modal-insight-item">
                    <span class="modal-insight-icon">üì¶</span>
                    <span>${category.units.toLocaleString()} units sold with avg order value of ‚Çπ${(category.revenue / category.transactions).toFixed(0)}</span>
                </div>
                <div class="modal-insight-item">
                    <span class="modal-insight-icon">üí∞</span>
                    <span>Total profit: ‚Çπ${((category.revenue * category.margin) / 2663).toFixed(2)} Cr</span>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // Close Modal
        function closeModal(event) {
            const modal = document.getElementById('modalOverlay');
            if (event.target === modal || event.target.classList.contains('modal-close')) {
                modal.style.display = 'none';
            }
        }

        // ESC key to close modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.getElementById('modalOverlay').style.display = 'none';
            }
        });
    </script>
</body>
</html>