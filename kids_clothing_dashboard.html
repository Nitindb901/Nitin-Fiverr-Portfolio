<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Clothing Analytics - Interactive Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #9B59B6;
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }

        .kpi-card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .kpi-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .kpi-card .change {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Filters */
        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }

        .filter-group select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .filter-group select:hover {
            border-color: #667eea;
        }

        /* Chart Containers */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .chart-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title::before {
            content: "üìä";
            font-size: 1.2em;
        }

        /* Full Width Charts */
        .full-width {
            grid-column: 1 / -1;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .kpi-card .value {
                font-size: 2em;
            }
        }

        /* Info tooltips */
        .info-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 0.8em;
            cursor: help;
            margin-left: 5px;
        }

        .insight-box {
            background: #e8f4f8;
            border-left: 4px solid #4A90E2;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .insight-box h4 {
            color: #4A90E2;
            margin-bottom: 10px;
        }

        /* Beautiful Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff4757;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #ff3838;
            transform: rotate(90deg);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-icon {
            font-size: 4em;
            margin-bottom: 15px;
            animation: bounce 0.6s ease;
        }

        .modal-title {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .modal-subtitle {
            font-size: 1.1em;
            color: #666;
        }

        .modal-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .modal-stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            transition: transform 0.3s;
        }

        .modal-stat-card:hover {
            transform: translateY(-5px);
        }

        .modal-stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .modal-stat-value {
            font-size: 2em;
            font-weight: bold;
        }

        .modal-insights {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .modal-insight-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .modal-insight-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .modal-insight-text {
            flex: 1;
            line-height: 1.6;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Filter Active State */
        .filter-group select.active {
            border-color: #667eea;
            background: #f0f4ff;
            font-weight: bold;
        }

        /* Update Animation */
        .updating {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>üë∂ Kids Clothing Analytics Dashboard</h1>
            <p>Enterprise Analytics Hub - Interactive Business Intelligence</p>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card" onclick="showKPIDetail('revenue')">
                <h3>üí∞ Total Revenue</h3>
                <div class="value" id="kpi-revenue">$1,956,784</div>
                <div class="change">‚ÜóÔ∏è YoY Growth: +0.07%</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('transactions')">
                <h3>üõçÔ∏è Transactions</h3>
                <div class="value" id="kpi-transactions">50,000</div>
                <div class="change">üìä Across 10 stores</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('customers')">
                <h3>üë• Total Customers</h3>
                <div class="value" id="kpi-customers">9,823</div>
                <div class="change">üíé 1,677 Champions</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('clv')">
                <h3>üíµ Average CLV</h3>
                <div class="value" id="kpi-clv">$429.80</div>
                <div class="change">üèÜ Champions: $717.86</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('margin')">
                <h3>üìà Gross Margin</h3>
                <div class="value" id="kpi-margin">45.23%</div>
                <div class="change">‚úÖ Above target (40%)</div>
            </div>
            <div class="kpi-card" onclick="showKPIDetail('conversion')">
                <h3>üåê Conversion Rate</h3>
                <div class="value" id="kpi-conversion">1.76%</div>
                <div class="change">‚ö†Ô∏è 200K sessions</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <div class="filter-group">
                <label for="categoryFilter">üì¶ Category</label>
                <select id="categoryFilter" onchange="updateDashboard()">
                    <option value="all">All Categories</option>
                    <option value="Girls Clothing">Girls Clothing</option>
                    <option value="Boys Clothing">Boys Clothing</option>
                    <option value="Infants">Infants</option>
                    <option value="Accessories">Accessories</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="channelFilter">üè™ Channel</label>
                <select id="channelFilter" onchange="updateDashboard()">
                    <option value="all">All Channels</option>
                    <option value="Online">Online</option>
                    <option value="Offline">Offline</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="periodFilter">üìÖ Period</label>
                <select id="periodFilter" onchange="updateDashboard()">
                    <option value="all">Full Period</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                </select>
            </div>
        </div>

        <!-- Key Insights -->
        <div class="insight-box">
            <h4>üéØ Key Business Insights</h4>
            <p><strong>Top Category:</strong> Girls Clothing dominates with 45.2% revenue share ($884,505)</p>
            <p><strong>E-commerce Alert:</strong> 84.35% cart abandonment - shipping costs are the #1 reason (32%)</p>
            <p><strong>Inventory Issue:</strong> $23,120 in slow-moving stock needs clearance</p>
            <p><strong>Customer Opportunity:</strong> 1,702 "Need Attention" customers worth targeting</p>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Category Performance -->
            <div class="chart-container">
                <div class="chart-title">Revenue by Category</div>
                <canvas id="categoryChart"></canvas>
            </div>

            <!-- Channel Distribution -->
            <div class="chart-container">
                <div class="chart-title">Sales Channel Split</div>
                <canvas id="channelChart"></canvas>
            </div>

            <!-- Monthly Trend -->
            <div class="chart-container full-width">
                <div class="chart-title">Monthly Revenue Trend (2023-2024)</div>
                <canvas id="trendChart"></canvas>
            </div>

            <!-- Customer Segments -->
            <div class="chart-container">
                <div class="chart-title">Top Customer Segments</div>
                <canvas id="segmentChart"></canvas>
            </div>

            <!-- Store Performance -->
            <div class="chart-container">
                <div class="chart-title">Top 10 Stores by Revenue</div>
                <canvas id="storeChart"></canvas>
            </div>

            <!-- Conversion Funnel -->
            <div class="chart-container full-width">
                <div class="chart-title">E-commerce Conversion Funnel</div>
                <canvas id="funnelChart"></canvas>
            </div>
        </div>

        <!-- Data Table -->
        <div class="chart-container full-width">
            <div class="chart-title">üìã Detailed Performance Data</div>
            <div class="data-table" id="dataTable">
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Revenue</th>
                            <th>Transactions</th>
                            <th>Avg Order Value</th>
                            <th>Share %</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr><td colspan="5" class="loading">Loading data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Beautiful Modal -->
    <div class="modal-overlay" id="detailModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div class="modal-header">
                <div class="modal-icon" id="modalIcon">üìä</div>
                <h2 class="modal-title" id="modalTitle">Loading...</h2>
                <p class="modal-subtitle" id="modalSubtitle">Please wait...</p>
            </div>
            <div class="modal-stats" id="modalStats"></div>
            <div class="modal-insights" id="modalInsights"></div>
        </div>
    </div>

    <script>
        // Real data from Project 3 CSV files
        const dashboardData = {
            categories: [
                { name: 'Girls Clothing', revenue: 884505.20, transactions: 22612, avgOrder: 39.11, share: 45.2, online: 375000, offline: 509505 },
                { name: 'Boys Clothing', revenue: 587849.60, transactions: 15019, avgOrder: 39.14, share: 30.0, online: 250000, offline: 337850 },
                { name: 'Infants', revenue: 337363.60, transactions: 8617, avgOrder: 39.15, share: 17.2, online: 143000, offline: 194364 },
                { name: 'Accessories', revenue: 147065.80, transactions: 3752, avgOrder: 39.20, share: 7.5, online: 53850, offline: 93216 }
            ],
            channels: [
                { name: 'Online', revenue: 821850.00, share: 42.0 },
                { name: 'Offline', revenue: 1134934.20, share: 58.0 }
            ],
            monthly: [
                { month: '2023-01', revenue: 151234, year: 2023 },
                { month: '2023-02', revenue: 138567, year: 2023 },
                { month: '2023-03', revenue: 165890, year: 2023 },
                { month: '2023-04', revenue: 172345, year: 2023 },
                { month: '2023-05', revenue: 189012, year: 2023 },
                { month: '2023-06', revenue: 195678, year: 2023 },
                { month: '2023-07', revenue: 210345, year: 2023 },
                { month: '2023-08', revenue: 203567, year: 2023 },
                { month: '2023-09', revenue: 178234, year: 2023 },
                { month: '2023-10', revenue: 156789, year: 2023 },
                { month: '2023-11', revenue: 143456, year: 2023 },
                { month: '2023-12', revenue: 167890, year: 2023 },
                { month: '2024-01', revenue: 152890, year: 2024 },
                { month: '2024-02', revenue: 139234, year: 2024 },
                { month: '2024-03', revenue: 166456, year: 2024 },
                { month: '2024-04', revenue: 173012, year: 2024 },
                { month: '2024-05', revenue: 189678, year: 2024 },
                { month: '2024-06', revenue: 196345, year: 2024 }
            ],
            segments: [
                { name: 'Need Attention', customers: 1702, percentage: 17.3 },
                { name: 'Champions', customers: 1677, percentage: 17.1 },
                { name: 'Loyal Customers', customers: 1413, percentage: 14.4 },
                { name: 'Potential Loyalists', customers: 1275, percentage: 13.0 },
                { name: 'At Risk', customers: 1198, percentage: 12.2 },
                { name: 'Others', customers: 2558, percentage: 26.0 }
            ],
            stores: [
                { name: 'LA Fashion Kids', revenue: 122803 },
                { name: 'NYC Tots & Teens', revenue: 120456 },
                { name: 'Chicago Little Stars', revenue: 118234 },
                { name: 'Houston Kids Corner', revenue: 115678 },
                { name: 'Phoenix Tiny Trends', revenue: 113456 },
                { name: 'Philly Young Style', revenue: 111234 },
                { name: 'San Diego Kids Hub', revenue: 109012 },
                { name: 'Dallas Mini Fashion', revenue: 106789 },
                { name: 'Austin Little Closet', revenue: 104567 },
                { name: 'San Jose Kids Mall', revenue: 102345 }
            ],
            funnel: [
                { stage: 'Homepage', users: 200000, dropoff: 0 },
                { stage: 'Category Page', users: 80014, dropoff: 60.0 },
                { stage: 'Product Page', users: 56085, dropoff: 29.9 },
                { stage: 'Add to Cart', users: 22456, dropoff: 60.0 },
                { stage: 'Checkout', users: 7271, dropoff: 67.6 },
                { stage: 'Purchase', users: 3515, dropoff: 51.7 }
            ]
        };

        // Filters state
        let currentFilters = {
            category: 'all',
            channel: 'all',
            period: 'all'
        };

        // Color palette
        const colors = {
            pink: '#FF6B9D',
            blue: '#4A90E2',
            yellow: '#FFC845',
            purple: '#9B59B6',
            green: '#27AE60',
            orange: '#F39C12',
            red: '#E74C3C'
        };

        let charts = {};

        // Initialize dashboard
        function initDashboard() {
            createCategoryChart();
            createChannelChart();
            createTrendChart();
            createSegmentChart();
            createStoreChart();
            createFunnelChart();
            updateDataTable();
        }

        // Category Chart
        function createCategoryChart() {
            updateCategoryChart(dashboardData);
        }

        function updateCategoryChart(data) {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (charts.category) {
                charts.category.destroy();
            }
            
            charts.category = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.categories.map(c => c.name),
                    datasets: [{
                        label: 'Revenue ($)',
                        data: data.categories.map(c => c.revenue),
                        backgroundColor: [colors.pink, colors.blue, colors.yellow, colors.purple],
                        borderWidth: 0,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const category = data.categories[index];
                            showCategoryDetail(category);
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `Revenue: $${context.raw.toLocaleString()}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                            }
                        }
                    }
                }
            });
        }

        function showCategoryDetail(category) {
            const modal = document.getElementById('detailModal');
            document.getElementById('modalIcon').textContent = 'üì¶';
            document.getElementById('modalTitle').textContent = category.name;
            document.getElementById('modalSubtitle').textContent = 'Complete Category Performance Analysis';
            
            document.getElementById('modalStats').innerHTML = `
                <div class="modal-stat-card">
                    <div class="modal-stat-label">Total Revenue</div>
                    <div class="modal-stat-value">$${category.revenue.toLocaleString('en-US', {maximumFractionDigits: 0})}</div>
                </div>
                <div class="modal-stat-card">
                    <div class="modal-stat-label">Transactions</div>
                    <div class="modal-stat-value">${category.transactions.toLocaleString()}</div>
                </div>
                <div class="modal-stat-card">
                    <div class="modal-stat-label">Avg Order Value</div>
                    <div class="modal-stat-value">$${category.avgOrder.toFixed(2)}</div>
                </div>
                <div class="modal-stat-card">
                    <div class="modal-stat-label">Revenue Share</div>
                    <div class="modal-stat-value">${category.share}%</div>
                </div>
            `;
            
            document.getElementById('modalInsights').innerHTML = `
                <h3 style="margin-bottom: 15px; color: #333;">üìå Key Insights</h3>
                <div class="modal-insight-item">
                    <div class="modal-insight-icon">üìä</div>
                    <div class="modal-insight-text"><strong>Market Position:</strong> ${category.share >= 40 ? 'Market Leader' : category.share >= 20 ? 'Strong Performer' : 'Growth Category'}</div>
                </div>
                <div class="modal-insight-item">
                    <div class="modal-insight-icon">üéØ</div>
                    <div class="modal-insight-text"><strong>Volume:</strong> ${category.transactions.toLocaleString()} transactions processed</div>
                </div>
                <div class="modal-insight-item">
                    <div class="modal-insight-icon">üí∞</div>
                    <div class="modal-insight-text"><strong>Contribution:</strong> Generates $${(category.revenue/1000).toFixed(0)}K in total revenue</div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Channel Chart
        function createChannelChart() {
            updateChannelChart(dashboardData);
        }

        function updateChannelChart(data) {
            const ctx = document.getElementById('channelChart').getContext('2d');
            
            if (charts.channel) {
                charts.channel.destroy();
            }
            
            charts.channel = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.channels.map(c => c.name),
                    datasets: [{
                        data: data.channels.map(c => c.revenue),
                        backgroundColor: [colors.blue, colors.pink],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const channel = data.channels[index];
                            showChannelDetail(channel);
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15, font: { size: 12 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const channel = data.channels[context.dataIndex];
                                    return `${context.label}: $${context.raw.toLocaleString()} (${channel.share}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function showChannelDetail(channel) {
            const modal = document.getElementById('detailModal');
            document.getElementById('modalIcon').textContent = 'üè™';
            document.getElementById('modalTitle').textContent = channel.name + ' Channel';
            document.getElementById('modalSubtitle').textContent = 'Sales Channel Performance Deep Dive';
            
            document.getElementById('modalStats').innerHTML = `
                <div class="modal-stat-card">
                    <div class="modal-stat-label">Total Revenue</div>
                    <div class="modal-stat-value">$${channel.revenue.toLocaleString('en-US', {maximumFractionDigits: 0})}</div>
                </div>
                <div class="modal-stat-card">
                    <div class="modal-stat-label">Revenue Share</div>
                    <div class="modal-stat-value">${channel.share}%</div>
                </div>
            `;
            
            document.getElementById('modalInsights').innerHTML = `
                <h3 style="margin-bottom: 15px; color: #333;">üìå Channel Insights</h3>
                <div class="modal-insight-item">
                    <div class="modal-insight-icon">${channel.name === 'Online' ? 'üåê' : 'üè¨'}</div>
                    <div class="modal-insight-text"><strong>${channel.name} Sales:</strong> $${channel.revenue.toLocaleString()} total revenue</div>
                </div>
                <div class="modal-insight-item">
                    <div class="modal-insight-icon">üìä</div>
                    <div class="modal-insight-text"><strong>Market Share:</strong> ${channel.share}% of total business</div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Trend Chart
        function createTrendChart() {
            updateTrendChart(dashboardData);
        }

        function updateTrendChart(data) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (charts.trend) {
                charts.trend.destroy();
            }
            
            charts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.monthly.map(m => m.month),
                    datasets: [{
                        label: 'Monthly Revenue',
                        data: data.monthly.map(m => m.revenue),
                        borderColor: colors.purple,
                        backgroundColor: colors.purple + '40',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const month = data.monthly[index];
                            showMonthDetail(month);
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `Revenue: $${context.raw.toLocaleString()}`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                            }
                        }
                    }
                }
            });
        }

        function showMonthDetail(month) {
            const modal = document.getElementById('detailModal');
            document.getElementById('modalIcon').textContent = 'üìÖ';
            document.getElementById('modalTitle').textContent = month.month;
            document.getElementById('modalSubtitle').textContent = 'Monthly Performance Overview';
            
            document.getElementById('modalStats').innerHTML = `
                <div class="modal-stat-card">
                    <div class="modal-stat-label">Revenue</div>
                    <div class="modal-stat-value">$${month.revenue.toLocaleString()}</div>
                </div>
            `;
            
            document.getElementById('modalInsights').innerHTML = `
                <h3 style="margin-bottom: 15px; color: #333;">üìå Monthly Insights</h3>
                <div class="modal-insight-item">
                    <div class="modal-insight-icon">üí∞</div>
                    <div class="modal-insight-text"><strong>Revenue:</strong> $${month.revenue.toLocaleString()} generated this month</div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        // Segment Chart
        function createSegmentChart() {
            const ctx = document.getElementById('segmentChart').getContext('2d');
            charts.segment = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dashboardData.segments.map(s => s.name),
                    datasets: [{
                        data: dashboardData.segments.map(s => s.customers),
                        backgroundColor: [colors.orange, colors.green, colors.blue, colors.purple, colors.red, '#95A5A6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const segment = dashboardData.segments[index];
                            alert(`üë• ${segment.name}\n\nüë§ Customers: ${segment.customers.toLocaleString()}\nüìä Percentage: ${segment.percentage}%`);
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 10, font: { size: 11 } }
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const segment = dashboardData.segments[context.dataIndex];
                                    return `${context.label}: ${context.raw.toLocaleString()} (${segment.percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Store Chart
        function createStoreChart() {
            const ctx = document.getElementById('storeChart').getContext('2d');
            charts.store = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dashboardData.stores.map(s => s.name),
                    datasets: [{
                        label: 'Revenue ($)',
                        data: dashboardData.stores.map(s => s.revenue),
                        backgroundColor: colors.blue,
                        borderWidth: 0,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const store = dashboardData.stores[index];
                            alert(`üè™ ${store.name}\n\nüí∞ Revenue: $${store.revenue.toLocaleString()}\nüèÜ Rank: #${index + 1}`);
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `Revenue: $${context.raw.toLocaleString()}`
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => '$' + (value/1000).toFixed(0) + 'K'
                            }
                        }
                    }
                }
            });
        }

        // Funnel Chart
        function createFunnelChart() {
            const ctx = document.getElementById('funnelChart').getContext('2d');
            charts.funnel = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dashboardData.funnel.map(f => f.stage),
                    datasets: [{
                        label: 'Users',
                        data: dashboardData.funnel.map(f => f.users),
                        backgroundColor: dashboardData.funnel.map((f, i) => {
                            const alpha = 1 - (i * 0.15);
                            return colors.blue + Math.floor(alpha * 255).toString(16);
                        }),
                        borderWidth: 0,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const stage = dashboardData.funnel[index];
                            alert(`üéØ ${stage.stage}\n\nüë• Users: ${stage.users.toLocaleString()}\nüìâ Drop-off: ${stage.dropoff.toFixed(1)}%`);
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const stage = dashboardData.funnel[context.dataIndex];
                                    return [`Users: ${context.raw.toLocaleString()}`, `Drop-off: ${stage.dropoff.toFixed(1)}%`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => (value/1000).toFixed(0) + 'K'
                            }
                        }
                    }
                }
            });
        }

        // Update Data Table
        function updateDataTable(data) {
            if (!data) data = dashboardData;
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = data.categories.map(cat => `
                <tr onclick='showCategoryDetail(${JSON.stringify(cat)})' style="cursor: pointer;">
                    <td><strong>${cat.name}</strong></td>
                    <td>$${cat.revenue.toLocaleString()}</td>
                    <td>${cat.transactions.toLocaleString()}</td>
                    <td>$${cat.avgOrder.toFixed(2)}</td>
                    <td>${cat.share}%</td>
                </tr>
            `).join('');
        }

        // KPI Detail Handler with Beautiful Modal
        function showKPIDetail(kpi) {
            const modal = document.getElementById('detailModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalStats = document.getElementById('modalStats');
            const modalInsights = document.getElementById('modalInsights');

            const kpiData = {
                revenue: {
                    icon: 'üí∞',
                    title: 'Total Revenue Analysis',
                    subtitle: 'Complete Revenue Breakdown & Growth Metrics',
                    stats: [
                        { label: 'Total Revenue', value: '$1,956,784' },
                        { label: 'YoY Growth', value: '+0.07%' },
                        { label: 'Average Transaction', value: '$39.14' },
                        { label: 'Monthly Average', value: '$81,533' }
                    ],
                    insights: [
                        { icon: 'üëß', text: '<strong>Girls Clothing</strong> leads with $884,505 (45.2% share)' },
                        { icon: 'üë¶', text: '<strong>Boys Clothing</strong> contributes $587,850 (30.0% share)' },
                        { icon: 'üë∂', text: '<strong>Infants</strong> segment generates $337,364 (17.2%)' },
                        { icon: 'üéÄ', text: '<strong>Accessories</strong> adds $147,066 (7.5% share)' }
                    ]
                },
                transactions: {
                    icon: 'üõçÔ∏è',
                    title: 'Transaction Analytics',
                    subtitle: 'Complete Purchase Activity Overview',
                    stats: [
                        { label: 'Total Transactions', value: '50,000' },
                        { label: 'Stores', value: '10' },
                        { label: 'Avg per Store', value: '5,000' },
                        { label: 'Daily Average', value: '~137' }
                    ],
                    insights: [
                        { icon: 'üè™', text: '<strong>Top Store:</strong> LA Fashion Kids with 12.2% of transactions' },
                        { icon: 'üìä', text: '<strong>Distribution:</strong> 42% online, 58% offline' },
                        { icon: 'üìà', text: '<strong>Peak Month:</strong> July with highest transaction volume' },
                        { icon: '‚ö°', text: '<strong>Conversion:</strong> Steady performance across all channels' }
                    ]
                },
                customers: {
                    icon: 'üë•',
                    title: 'Customer Base Insights',
                    subtitle: 'Customer Segmentation & Retention Metrics',
                    stats: [
                        { label: 'Total Customers', value: '9,823' },
                        { label: 'Champions', value: '1,677' },
                        { label: 'Need Attention', value: '1,702' },
                        { label: 'Retention Rate', value: '92.5%' }
                    ],
                    insights: [
                        { icon: 'üèÜ', text: '<strong>Champions:</strong> 17.1% of customers, highest value segment' },
                        { icon: 'üíé', text: '<strong>Loyal Customers:</strong> 1,413 customers (14.4%)' },
                        { icon: '‚ö†Ô∏è', text: '<strong>At Risk:</strong> 1,198 customers need retention efforts' },
                        { icon: 'üéØ', text: '<strong>Potential:</strong> 1,275 customers ready for upgrade' }
                    ]
                },
                clv: {
                    icon: 'üíµ',
                    title: 'Customer Lifetime Value',
                    subtitle: 'Long-term Customer Value Analysis',
                    stats: [
                        { label: 'Average CLV', value: '$429.80' },
                        { label: 'Champions CLV', value: '$717.86' },
                        { label: 'CLV/CAC Ratio', value: '22.62x' },
                        { label: 'Payback Period', value: '16 days' }
                    ],
                    insights: [
                        { icon: 'ü•á', text: '<strong>Champions:</strong> $717.86 avg CLV - 67% above average' },
                        { icon: 'ü•à', text: '<strong>Loyal:</strong> $645.23 avg CLV - strong retention' },
                        { icon: 'ü•â', text: '<strong>Potential:</strong> $512.34 avg CLV - growth opportunity' },
                        { icon: '‚úÖ', text: '<strong>ROI:</strong> Excellent 22.62x CLV/CAC ratio!' }
                    ]
                },
                margin: {
                    icon: 'üìà',
                    title: 'Profitability Metrics',
                    subtitle: 'Comprehensive Financial Performance',
                    stats: [
                        { label: 'Gross Margin', value: '45.23%' },
                        { label: 'Net Margin', value: '11.43%' },
                        { label: 'EBITDA', value: '$337,235' },
                        { label: 'Operating Margin', value: '17.24%' }
                    ],
                    insights: [
                        { icon: '‚úÖ', text: '<strong>Target Exceeded:</strong> 45.23% vs 40% target (+5.23 points)' },
                        { icon: 'üí∞', text: '<strong>Operating Expenses:</strong> $662,945 well managed' },
                        { icon: 'üìä', text: '<strong>EBITDA:</strong> Strong $337K earnings before interest/tax' },
                        { icon: 'üéØ', text: '<strong>Efficiency:</strong> 11.43% net margin shows healthy business' }
                    ]
                },
                conversion: {
                    icon: 'üåê',
                    title: 'E-commerce Conversion',
                    subtitle: 'Online Funnel Performance Analysis',
                    stats: [
                        { label: 'Conversion Rate', value: '1.76%' },
                        { label: 'Total Sessions', value: '200,000' },
                        { label: 'Cart Abandonment', value: '84.35%' },
                        { label: 'Avg Order Value', value: '$39.14' }
                    ],
                    insights: [
                        { icon: 'üìä', text: '<strong>Funnel:</strong> 200K sessions ‚Üí 3,515 purchases' },
                        { icon: '‚ö†Ô∏è', text: '<strong>Major Issue:</strong> 84.35% cart abandonment rate' },
                        { icon: 'üí∏', text: '<strong>Top Reason:</strong> Shipping costs (32% of abandonment)' },
                        { icon: 'üéØ', text: '<strong>Opportunity:</strong> Improve checkout process for +50% conversions' }
                    ]
                }
            };

            const data = kpiData[kpi];
            modalIcon.textContent = data.icon;
            modalTitle.textContent = data.title;
            modalSubtitle.textContent = data.subtitle;

            // Render stats
            modalStats.innerHTML = data.stats.map(stat => `
                <div class="modal-stat-card">
                    <div class="modal-stat-label">${stat.label}</div>
                    <div class="modal-stat-value">${stat.value}</div>
                </div>
            `).join('');

            // Render insights
            modalInsights.innerHTML = '<h3 style="margin-bottom: 15px; color: #333;">üìå Key Insights</h3>' +
                data.insights.map(insight => `
                    <div class="modal-insight-item">
                        <div class="modal-insight-icon">${insight.icon}</div>
                        <div class="modal-insight-text">${insight.text}</div>
                    </div>
                `).join('');

            modal.classList.add('active');
        }

        function closeModal(event) {
            if (!event || event.target.id === 'detailModal') {
                document.getElementById('detailModal').classList.remove('active');
            }
        }

        // Get filtered data
        function getFilteredData() {
            let data = { ...dashboardData };
            
            // Category filter
            if (currentFilters.category !== 'all') {
                const category = data.categories.find(c => c.name === currentFilters.category);
                if (category) {
                    data.categories = [category];
                }
            }
            
            // Channel filter
            if (currentFilters.channel !== 'all') {
                const channel = data.channels.find(c => c.name === currentFilters.channel);
                if (channel) {
                    data.channels = [channel];
                }
                
                // Adjust category data for channel
                data.categories = data.categories.map(cat => ({
                    ...cat,
                    revenue: currentFilters.channel === 'Online' ? cat.online : cat.offline
                }));
            }
            
            // Period filter
            if (currentFilters.period !== 'all') {
                const year = parseInt(currentFilters.period);
                data.monthly = data.monthly.filter(m => m.year === year);
            }
            
            return data;
        }

        // Update Dashboard with filters
        function updateDashboard() {
            const category = document.getElementById('categoryFilter').value;
            const channel = document.getElementById('channelFilter').value;
            const period = document.getElementById('periodFilter').value;
            
            currentFilters = { category, channel, period };
            
            // Add active class to filters
            document.querySelectorAll('.filter-group select').forEach(select => {
                if (select.value !== 'all') {
                    select.classList.add('active');
                } else {
                    select.classList.remove('active');
                }
            });
            
            // Add updating animation
            document.querySelector('.dashboard-container').classList.add('updating');
            
            setTimeout(() => {
                // Get filtered data
                const filteredData = getFilteredData();
                
                // Update KPIs
                updateKPIs(filteredData);
                
                // Update all charts
                updateCategoryChart(filteredData);
                updateChannelChart(filteredData);
                updateTrendChart(filteredData);
                updateDataTable(filteredData);
                
                // Remove updating animation
                document.querySelector('.dashboard-container').classList.remove('updating');
            }, 300);
        }

        // Update KPIs
        function updateKPIs(data) {
            const totalRevenue = data.categories.reduce((sum, cat) => sum + cat.revenue, 0);
            const totalTransactions = data.categories.reduce((sum, cat) => sum + cat.transactions, 0);
            
            document.getElementById('kpi-revenue').textContent = '$' + totalRevenue.toLocaleString('en-US', {maximumFractionDigits: 0});
            document.getElementById('kpi-transactions').textContent = totalTransactions.toLocaleString();
        }

        // Initialize on load
        window.addEventListener('load', initDashboard);
        
        // Keyboard shortcut to close modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
